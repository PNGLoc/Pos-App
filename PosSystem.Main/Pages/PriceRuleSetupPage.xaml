<UserControl x:Class="PosSystem.Main.Pages.PriceRuleSetupPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- HEADER: ÁP DỤNG GIÁ -->
        <Border Grid.Row="0"
                Background="#E9ECEF"
                Padding="15"
                BorderThickness="0,0,0,1"
                BorderBrush="#DDD">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                        Text="Áp dụng loại giá:"
                        FontWeight="Bold"
                        VerticalAlignment="Center"
                        Margin="0,0,10,0"/>
                <ComboBox x:Name="cboActiveRule"
                        Grid.Column="1"
                        Height="35"
                        VerticalAlignment="Center"
                        SelectionChanged="CboActiveRule_SelectionChanged"/>

                <TextBlock Grid.Column="2"
                        Text=""/>
                <TextBlock Grid.Column="3"
                        Text=""/>
                <TextBlock Grid.Column="4"
                        Text=""/>
                <Button Grid.Column="5"
                        Content="➕ Thêm Mới"
                        Width="100"
                        Height="35"
                        Background="#28A745"
                        Foreground="White"
                        Click="BtnShowAddForm_Click"/>
            </Grid>
        </Border>

        <!-- CONTENT: QUẢN LÝ LOẠI GIÁ -->
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Danh sách loại giá -->
            <DataGrid x:Name="dgRuleTypes"
                      Grid.Row="0"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      Margin="10"
                      SelectionChanged="dgRuleTypes_SelectionChanged">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Loại Giá"
                                        Binding="{Binding RuleType}"
                                        Width="150"
                                        IsReadOnly="False"/>
                    <DataGridTextColumn Header="Số Sản Phẩm"
                                        Binding="{Binding ProductCount}"
                                        Width="100"
                                        IsReadOnly="True"/>
                    <DataGridTemplateColumn Header="Hành động"
                            Width="200">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal"
                                        Margin="5">
                                    <Button Content="Chi tiết"
                                            Width="60"
                                            Height="30"
                                            Background="#17A2B8"
                                            Foreground="White"
                                            Click="BtnEditRuleType_Click"
                                            Margin="0,0,5,0"/>
                                    <Button Content="Xóa"
                                            Width="50"
                                            Height="30"
                                            Background="#DC3545"
                                            Foreground="White"
                                            Click="BtnDeleteRuleType_Click"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Form thêm loại giá (hiển thị khi cần) -->
            <Border Grid.Row="1"
                    Background="#F8F9FA"
                    Padding="15"
                    Margin="10,0,10,10"
                    x:Name="AddRulePanel"
                    Visibility="Collapsed"
                    BorderThickness="1"
                    BorderBrush="#DDD">
                <StackPanel>
                    <TextBlock Text="THÊM LOẠI GIÁ MỚI"
                            FontWeight="Bold"
                            FontSize="14"
                            Margin="0,0,0,15"/>

                    <TextBlock Text="Loại Giá (holiday, event, vip):"/>
                    <TextBox x:Name="txtRuleType"
                            Height="35"
                            Margin="0,5,0,15"/>

                    <CheckBox x:Name="chkRuleTypeActive"
                            Content="Hoạt động"
                            IsChecked="True"
                            Margin="0,0,0,15"/>

                    <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right">
                        <Button Content="Thêm"
                                Width="80"
                                Height="35"
                                Background="#28A745"
                                Foreground="White"
                                Click="BtnAddRuleType_Click"
                                Margin="0,0,5,0"/>
                        <Button Content="Thoát"
                                Width="80"
                                Height="35"
                                Background="#6C757D"
                                Foreground="White"
                                Click="BtnCancelAddForm_Click"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- OVERLAY: CHI TIẾT LOẠI GIÁ -->
            <Border Grid.RowSpan="2"
                    Background="#80000000"
                    x:Name="DetailOverlay"
                    Visibility="Collapsed"/>

            <Border Grid.RowSpan="2"
                    x:Name="DetailPanel"
                    Visibility="Collapsed"
                    Background="White"
                    CornerRadius="5"
                    Margin="50"
                    BorderThickness="1"
                    BorderBrush="#CCC">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Border Grid.Row="0"
                            Background="#E9ECEF"
                            Padding="15"
                            BorderThickness="0,0,0,1"
                            BorderBrush="#DDD">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Loại giá:"
                                       FontWeight="Bold"
                                       VerticalAlignment="Center"
                                       Margin="0,0,10,0"/>
                            <TextBlock x:Name="lblSelectedRuleType"
                                       Text="Chưa chọn"
                                       VerticalAlignment="Center"
                                       FontSize="16"
                                       Foreground="#007BFF"
                                       FontWeight="Bold"/>
                        </StackPanel>
                    </Border>

                    <!-- Danh sách sản phẩm -->
                    <DataGrid x:Name="dgRuleDetails"
                              Grid.Row="1"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Margin="15">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Tên Sản Phẩm"
                                                Binding="{Binding DishName}"
                                                Width="250"
                                                IsReadOnly="True"/>
                            <DataGridTextColumn Header="Giá Gốc"
                                                Binding="{Binding BasePrice, StringFormat=N0}"
                                                Width="150"
                                                IsReadOnly="True"/>
                            <DataGridTextColumn Header="Giá Mới"
                                                Binding="{Binding NewPrice, UpdateSourceTrigger=PropertyChanged}"
                                                Width="150"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Buttons -->
                    <Border Grid.Row="2"
                            Background="#F8F9FA"
                            Padding="15"
                            BorderThickness="0,1,0,0"
                            BorderBrush="#DDD">
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right">
                            <Button Content="Quay lại"
                                    Width="100"
                                    Height="35"
                                    Background="#6C757D"
                                    Foreground="White"
                                    Click="BtnBackToRuleList_Click"
                                    Margin="0,0,10,0"/>
                            <Button Content="Lưu"
                                    Width="100"
                                    Height="35"
                                    Background="#28A745"
                                    Foreground="White"
                                    Click="BtnSaveRuleDetails_Click"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>


