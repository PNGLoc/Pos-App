<Window x:Class="PosSystem.Main.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="POS Bán Hàng" Height="768" Width="1366"
        WindowStartupLocation="CenterScreen" WindowState="Maximized"
        Background="#F0F2F5">

    <Window.Resources>
        <Style x:Key="CategoryItemStyle" TargetType="ListBoxItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="border" Background="White" CornerRadius="8" Margin="0,0,10,0" Padding="15,10" BorderThickness="1" BorderBrush="#E0E0E0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#007BFF"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#007BFF"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#007BFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DishItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="border" Background="White" CornerRadius="8" BorderThickness="1" BorderBrush="#E0E0E0" Padding="0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="100"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Border Background="#F8F9FA" CornerRadius="8,8,0,0">
                                    <TextBlock Text="🍲" FontSize="40" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.5"/>
                                </Border>
                                <StackPanel Grid.Row="1" Padding="10">
                                    <TextBlock Text="{Binding DishName}" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{Binding Price, StringFormat={}{0:N0}đ}" Foreground="#28A745" FontWeight="SemiBold"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#007BFF"/>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.2"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PrinterToggleStyle" TargetType="ToggleButton">
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border" CornerRadius="5" Padding="15,0" Height="35" BorderThickness="0">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock x:Name="txtIcon" Text="🖨" Margin="0,0,8,0" Foreground="White" FontWeight="Bold" FontSize="16"/>
                                <TextBlock x:Name="txtStatus" Text="AUTO IN" Foreground="White" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#28A745"/>
                                <Setter TargetName="txtStatus" Property="Text" Value="AUTO IN"/>
                                <Setter TargetName="txtIcon" Property="Text" Value="🖨"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#DC3545"/>
                                <Setter TargetName="txtStatus" Property="Text" Value="KHÔNG IN"/>
                                <Setter TargetName="txtIcon" Property="Text" Value="🚫"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="False">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="1.0" To="0.4" Duration="0:0:0.8"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity" To="1.0" Duration="0:0:0.1"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <RowDefinition Height="*"/>    </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="0,0,0,15">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="btnBackToAdmin" Content="🔧 QUẢN TRỊ" Click="BtnBackToAdmin_Click" 
                        Height="35" Background="#343A40" Foreground="White" Padding="15,0" Margin="0,0,10,0" BorderThickness="0" FontWeight="Bold">
                    <Button.Resources><Style TargetType="Border"><Setter Property="CornerRadius" Value="5"/></Style></Button.Resources>
                </Button>

                <Button Content="📜 LỊCH SỬ ĐƠN" Click="BtnHistory_Click" 
                        Height="35" Background="#17A2B8" Foreground="White" Padding="15,0" Margin="0,0,10,0" BorderThickness="0" FontWeight="SemiBold">
                    <Button.Resources><Style TargetType="Border"><Setter Property="CornerRadius" Value="5"/></Style></Button.Resources>
                </Button>
            </StackPanel>

            <ToggleButton x:Name="tglPrintBill" 
                          Style="{StaticResource PrinterToggleStyle}"
                          IsChecked="True" 
                          HorizontalAlignment="Right"/>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>   <ColumnDefinition Width="1.2*"/> </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" Margin="0,0,15,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <ListBox x:Name="lstRegions" Grid.Row="0" Margin="0,0,0,15" 
                         ScrollViewer.HorizontalScrollBarVisibility="Hidden" Style="{StaticResource {x:Type ListBox}}">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem" BasedOn="{StaticResource CategoryItemStyle}"/>
                    </ListBox.ItemContainerStyle>
                </ListBox>

                <Border Grid.Row="1" Background="White" CornerRadius="10" Padding="15">
                    <ScrollViewer>
                        <ItemsControl x:Name="lstTables">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Width="110" Height="110" Margin="5" Click="Table_Click" Tag="{Binding TableID}">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="bdr" CornerRadius="8" Background="{Binding TableStatus, Converter={StaticResource StatusToColorConverter}}" Effect="{StaticResource ShadowEffect}">
                                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                                        <TextBlock Text="{Binding TableName}" FontWeight="Bold" FontSize="16" Foreground="White" HorizontalAlignment="Center"/>
                                                        <TextBlock Text="{Binding TableStatus}" FontSize="12" Foreground="White" Opacity="0.8" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>
            </Grid>

            <Border Grid.Column="1" Background="White" CornerRadius="10" Padding="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <RowDefinition Height="*"/>    <RowDefinition Height="Auto"/> </Grid.RowDefinitions>

                    <Border Background="#F8F9FA" Padding="15" CornerRadius="10,10,0,0" BorderThickness="0,0,0,1" BorderBrush="#EEE">
                        <Grid>
                            <StackPanel>
                                <TextBlock x:Name="lblSelectedTable" Text="Chọn bàn để bắt đầu" FontSize="18" FontWeight="Bold" Foreground="#333"/>
                                <TextBlock Text="Đơn hàng hiện tại" FontSize="12" Foreground="Gray"/>
                            </StackPanel>
                            <Button Content="➕ THÊM MÓN" HorizontalAlignment="Right" Background="#007BFF" Foreground="White" 
                                    Height="35" Padding="15,0" FontWeight="Bold" Click="BtnAddDish_Click" BorderThickness="0">
                                <Button.Resources><Style TargetType="Border"><Setter Property="CornerRadius" Value="5"/></Style></Button.Resources>
                            </Button>
                        </Grid>
                    </Border>

                    <ListView x:Name="lstOrderDetails" Grid.Row="1" BorderThickness="0" Background="White" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="{Binding DishName}" FontWeight="Bold" FontSize="14"/>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding BatchDisplay}" FontSize="11" Foreground="Gray" Margin="0,0,10,0"/>
                                            <TextBlock Text="{Binding StatusDisplay}" FontSize="11" FontWeight="Bold" Foreground="Red"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0">
                                        <Button Content="-" Width="30" Height="30" Click="BtnDecrease_Click" Tag="{Binding OrderDetailID}" Background="#EEE" BorderThickness="0" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding Quantity}" Width="30" TextAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                        <Button Content="+" Width="30" Height="30" Click="BtnIncrease_Click" Tag="{Binding OrderDetailID}" Background="#EEE" BorderThickness="0" FontWeight="Bold"/>
                                    </StackPanel>

                                    <TextBlock Grid.Column="2" Text="{Binding TotalAmount, StringFormat={}{0:N0}}" VerticalAlignment="Center" HorizontalAlignment="Right" FontWeight="SemiBold"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Background" Value="{Binding RowColor}"/>
                            </Style>
                        </ListView.ItemContainerStyle>
                    </ListView>

                    <StackPanel Grid.Row="2" Margin="15">
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button Grid.Column="0" Content="🎫 Giảm Bill" HorizontalAlignment="Left" Background="Transparent" Foreground="#007BFF" BorderThickness="0" Click="BtnDiscountBill_Click"/>
                            
                            <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <TextBlock Text="Tổng: "/>
                                    <TextBlock x:Name="lblSubTotal" Text="0đ" FontWeight="Bold"/>
                                </StackPanel>
                                <StackPanel x:Name="pnlDiscount" Orientation="Horizontal" HorizontalAlignment="Right" Visibility="Collapsed">
                                    <TextBlock Text="Giảm: " Foreground="Red"/>
                                    <TextBlock x:Name="lblDiscount" Text="-0đ" FontWeight="Bold" Foreground="Red"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,0,0">
                                    <TextBlock Text="KHÁCH TRẢ: " FontSize="18" FontWeight="Bold"/>
                                    <TextBlock x:Name="lblTotal" Text="0đ" FontSize="20" FontWeight="Bold" Foreground="#28A745"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>

                        <Button x:Name="btnSendKitchen" Content="👨‍🍳 GỬI BẾP" Height="50" Margin="0,0,0,10" 
                                Background="#FD7E14" Foreground="White" FontSize="16" FontWeight="Bold" Click="BtnSendKitchen_Click"/>
                        
                        <Button x:Name="btnCheckout" Content="THANH TOÁN" Height="50" 
                                Background="#28A745" Foreground="White" FontSize="18" FontWeight="Bold" IsEnabled="False" Click="btnCheckout_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>